
\chapter{系统实现和实验结果}
\label{chap:experiment}

\section{系统具体实现}
\label{sec:implementation}
我们采用Scala语言来搭建我们的系统。Scala是一种运行在JVM上的静态语言，支持函数式、
面向对象等多种编程范式，可以和Java代码无缝地进行交互。目前Scala还处于不断发展中，
新版本不向后兼容，我们的系统在Scala 2.10上可以编译通过。在工程管理上，我们使
用sbt管理Scala代码的编译和依赖关系。

在系统的实现中我们还使用了许多第三方库，除了在第~\ref{chap:cluster}章中介绍
的Actor库Akka，还有：
\begin{itemize}
\item 日志系统：基于twitter公司开源的util包，地址在
  \url{https://github.com/twitter/util}。
\item 网页字符集检测：ICU4J，地址在\url{http://site.icu-project.org}，这是一
  套UNICODE相关的工具集，提供了较好的字符集编码检测功能，我们用于检测中文网页的字
  符集。
\item HTML解析器：jsoup，地址在\url{http://jsoup.org}，是一个用Java语言实现
  的HTML解析器，用于DOM Tree的构建和节点内容的抽取。
\end{itemize}
\section{模板匹配演示系统}
\label{sec:demo}
为了直观地显示网页模板的匹配效果，我们基于Play! Framework的Web开发框架实现了一
个Web Service，用于实验的演示。该Web Service的工作原理
如\reffig{experiment:fig:demo}所示。
\begin{figure}
  \centering
  \includegraphics[width=0.75\textwidth]{experiment06/demo}
  \caption{Web Service工作原理}
  \label{experiment:fig:demo}
\end{figure}

用户需要输入一个用于和系统的模板进行匹配的网页的URL，系统返回给用户一个修改了样式
的新的网页，其中原网页和模板匹配上的部分会有和其他部分不同的显示效果，这样用户就
可以通过浏览器中直观地看到模板的匹配效果。

% TODO: 实验演示的效果如\reffig{experiment:fig:demoresult}所示
% \begin{figure}
%   \centering
%   \includegraphics[width=0.5\textwidth]{experiment06/demoresult}
%   \caption{实验演示系统效果}
%   \label{experiment:fig:demoresult}
% \end{figure}

\section{实验和分析}
\label{sec:result-analysis}

\subsection{实验环境和数据}
\label{sec:dataenv}
我们实验所用的机器的配置情况是：16个逻辑核的CPU，24G内存，操作系统为64位的CentOS。
后续的实验均在这个机器上进行。

我们有三个实验数据集，分别为博客（blog），新闻（news）和其他（others）。实验数据
集的概况如\reftbl{experiment:tab:overview}所示。%TODO
\begin{table}[h]
  \centering
% BEGIN RECEIVE ORGTBL 实验数据概况
\begin{tabular}{llll}
\toprule
 & blog & news & other \\
\hline
文件个数 & 59998 & 81561 & 183635 \\
总大小 & 5.4G & 7.9G & 18G \\
来源 & blog.sina.com.cn &  ent.sina.com.cn &  \\
\bottomrule
\end{tabular}
% END RECEIVE ORGTBL 实验数据概况
  \caption{实验数据概况}
  \label{experiment:tab:overview}
\end{table}
\begin{comment}
#+ORGTBL: SEND 实验数据概况 orgtbl-to-latex :splice nil :skip 0
|          | blog             | news            | other  |
|----------+------------------+-----------------+--------|
| 文件个数 | 59998            | 81561           | 183635 |
| 总大小   | 5.4G             | 7.9G            | 18G    |
| 来源     | blog.sina.com.cn | ent.sina.com.cn |        |
\end{comment}

接下来的几个小节我们将大体按照模块的顺序，依次介绍实验的详细情况。
\label{sec:results}
\subsection{预处理模块实验与分析}
\label{sec:experiement:pre}
在预处理模块中，我们首先将从原始的网页集合中过滤掉无用的网页，包括目录页和错误页，
采用的是第~\ref{sec:filterintro-useless}节中介绍的基于规则的方
法。\reftbl{experiment:tab:filter}给出了实验中使用的过滤规则和过滤后的结果。%TODO
\begin{table}[hb]
  \centering
% BEGIN RECEIVE ORGTBL 过滤无用网页
\begin{tabular}{lrrr}
  \toprule
 & blog & news & others \\
\hline
目录页URL规则 & .*(?<!\textbackslash\textbackslash.html?)\$ & .*(?<!\textbackslash\textbackslash.shtml)\$ &  \\
错误页最大长度 & 6000 & 6000 &  \\
文件个数 & 59998 & 81561 & 183635 \\
过滤后详细页个数 &  &  &  \\
\bottomrule
\end{tabular}
% END RECEIVE ORGTBL 过滤无用网页
  \caption{过滤无用网页实验结果}
  \label{experiment:tab:filter}
\end{table}
\begin{comment}
#+ORGTBL: SEND 过滤无用网页 orgtbl-to-latex :splice nil :skip 0
|                  |                                       blog |                                        news | others |
|------------------+--------------------------------------------+---------------------------------------------+--------|
| 目录页URL规则    | .*(?<!\textbackslash\textbackslash.html?)$ | .*(?<!\textbackslash\textbackslash.s?html)$ |        |
| 错误页最大长度   |                                       6000 |                                        6000 |        |
| 原来总文件个数   |                                      59998 |                                       81561 | 183635 |
| 过滤后详细页个数 |                                      35466 |                                       65655 |        |
\end{comment}

过滤掉了不需要的网页以后，我们得到了详细页的集合。我们从每个详细页集合中分别随机
抽取10000个样本作为每个集合的训练集。

接下来将去除无用的标签。\reftbl{experiment:tab:uselesstags}给出了我们实验中去掉无
用标签的几种正则表达式模式及每种模式对应的标签名。
\begin{table}[hb]
  \centering
% BEGIN RECEIVE ORGTBL 无用标签
\begin{tabular}{ll}
  \toprule
正则表达式模式 & 对应的标签名 \\
\hline
(?is)<tag.*?>.*?</tag> & style,script \\
(?is)<[/]?tag.*?> & link,input,br,img,meta,wbr \\
(?is)<[/]?tag.*?> & strong,em,font,b,p,li,ul,ol,td,tr,th,tbody,table \\
\bottomrule
\end{tabular}
% END RECEIVE ORGTBL 无用标签
  \caption{去掉的无用标签}
  \label{experiment:tab:uselesstags}
\end{table}
\begin{comment}
#+ORGTBL: SEND 无用标签 orgtbl-to-latex :splice nil :skip 0
| 正则表达式模式         | 对应的标签名                                     |
|------------------------+--------------------------------------------------|
| (?is)<tag.*?>.*?</tag> | style,script                                     |
| (?is)<[/]?tag.*?>      | link,input,br,img,meta,wbr                       |
| (?is)<[/]?tag.*?>      | strong,em,font,b,p,li,ul,ol,td,tr,th,tbody,table |
\end{comment}

下面我们对利用后缀树检测重复记录的算法的运行结果做一些统计。具体地，我们统计出每
个数据集中算法检测出的重复记录的长度的分布情况，结果如\reffig{experiment:fig:recordlength}所示。% TODO
\begin{figure}[hb]
  \centering
  \includegraphics[width=0.8\textwidth]{experiment06/recordlength}
  \caption{检测出的重复记录长度的分布情况}
  \label{experiment:fig:recordlength}
\end{figure}

我们可以看到，大部分的重复记录集中在。% Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enimad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

\subsection{聚类和模板生成模块实验和分析}
由于我们要处理的网页的数量非常多，计算网页的结构相似度将是我们整个系统最耗时的部
分，因此，我们先将训练集中所有的文档结构相似度离线算好，方便后续的实验。

在聚类模块中，最重要的实验参数是聚类时设置的相似度阈值。为了观察该阈值对实验结果
的影响，我们调整该阈值，观察聚类的个数的变化；同时，我们还将统计根据不同的聚类结
果生成的模块的一些信息，观察聚类阈值的变化对最后模板的生成有怎样的影响。我们选择
在news数据集上进行实验，具体的实验结果见\reftbl{experiment:tab:threshold}。%TODO

\begin{table}
% BEGIN RECEIVE ORGTBL 阈值变化
\begin{tabular}{rrrll}
阈值 & 聚类个数 & 模板平均长度 & 必选节点平均长度 & 可选节点平均长度 \\
\hline
0.2 &  &  &  &  \\
0.3 &  &  &  &  \\
0.4 & 9 & 22.6 &  &  \\
0.5 & 7 & 24.9 &  &  \\
0.6 & 5 & 24.8 &  &  \\
\end{tabular}
% END RECEIVE ORGTBL 阈值变化
\caption{阈值变化对实验结果的影响\label{experiment:tab:threshold}}
\end{table}
\begin{comment}
#+ORGTBL: SEND 阈值变化 orgtbl-to-latex :splice nil :skip 0
| 阈值 | 聚类个数 | 模板平均长度 | 必选节点平均长度 | 可选节点平均长度 |
|------+----------+--------------+------------------+------------------|
|  0.2 |          |              |                  |                  |
|  0.3 |          |              |                  |                  |
|  0.4 |        9 |         22.6 |             4.66 |             2.59 |
|  0.5 |        7 |         24.9 |             4.68 |             2.71 |
|  0.6 |        5 |         24.8 |             3.76 |             2.90 |
|  0.7 |        2 |              |                  |                  |
\end{comment}


从\reftbl{experiment:tab:threshold}所示的实验结果中，我们可以看到聚类时设置的阈值
大小不仅会影响聚类的个数，对后续的模板生成也有较大的影响。通过分析，我们可以得到以下几个结论：%TODO： 分析！
\begin{itemize}
\item 聚类时的阈值越小，
\end{itemize}

\subsection{内容抽取模块实验}
为了验证我们的系统能在实际的生产环境中使用，我们在测试集上进行了实验。首先是人工
对每个模板进行少量标注，然后利用标注好的模板，对每个新的网页（测试集）进行内容抽
取，最后将抽取的内容用XML格式保存下来。\reffig{experiment:fig:xmloutput}是我们保
存到XML中的结果的截图。
\begin{figure}[hb]
  \centering
  \includegraphics[width=0.5\textwidth]{experiment06/xmloutput}
  \caption{XML保存的结果截图}
  \label{experiment:fig:xmloutput}
\end{figure}

从\reffig{experiment:fig:xmloutput}可以看到，我们。%TODO:
\section{实验结果总结}
\label{sec:analysis}
对于以上的实验结果，我们可以做一个简单的总结：%TODO
\begin{itemize}
\item 在预处理模块
\end{itemize}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../main"
%%% End: 
